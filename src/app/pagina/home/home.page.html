<ion-header [translucent]="true">
  <ion-toolbar color="tertiary">
    <ion-buttons slot="start"><ion-menu-button></ion-menu-button></ion-buttons>
    <ion-title>Home</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="home-content">

  <div class="boas-vindas">
    <h2>Bem-vindo, {{ nomeUsuario }}!</h2>
    <p>VocÃª tem {{ idade }} anos e estÃ¡ controlando bem suas finanÃ§as ðŸ’ª</p>
  </div>

  <ion-card *ngIf="metaMensal > 0">
    <ion-card-header>
      <ion-card-title>Meta do MÃªs</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>Sua meta Ã© <strong>{{ formatCurrency(metaMensal) }}</strong>.</p>
      <p>VocÃª jÃ¡ gastou <strong>{{ formatCurrency(totalGastos) }}</strong>.</p>
      <ion-progress-bar [value]="clamp01(totalGastos / (metaMensal || 1))" color="tertiary"></ion-progress-bar>
      <p *ngIf="totalGastos < metaMensal">
        Faltam <strong>{{ restantePercentual() }}%</strong> para atingir sua meta.
      </p>
      <p *ngIf="totalGastos >= metaMensal">
        <strong>VocÃª atingiu ou ultrapassou sua meta!</strong>
      </p>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Resumo - {{ mesAtual | titlecase }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div>Total gasto: <strong>{{ formatCurrency(totalGastos) }}</strong></div>
      <div class="grafico-container">
        <canvas #gastoChart></canvas>
        <div class="grafico-empty" *ngIf="!hasCategorias()">Sem categorias para o mÃªs</div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- correÃ§Ã£o aplicada aqui: evita 'possibly undefined' para length -->
  <ion-card *ngIf="(familia?.length || 0) > 0">
    <ion-card-header>
      <ion-card-title>FamÃ­lia Financeira</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>Total gasto pela famÃ­lia: <strong>{{ formatCurrency(totalFamilia) }}</strong></p>
      <p>Membro com maior gasto: <strong>{{ maiorGastoNome || '-' }}</strong> ({{ formatCurrency(maiorGastoValor) }})</p>

      <ion-list lines="none">
        <ion-item *ngFor="let f of familia">
          <ion-label>
            <div class="fam-line">
              <div class="fam-name">{{ f.nome }}</div>
              <div class="fam-value">{{ formatCurrency(f.gasto || 0) }}</div>
            </div>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="resumo.total > 0">
    <ion-card-header>
      <ion-card-title>Categorias</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let cat of (resumo.porCategoria | keyvalue)">
          <ion-label>
            {{ cat.key }}
            <p class="muted">{{ formatCurrency(cat.value) }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="ultimos.length > 0">
    <ion-card-header>
      <ion-card-title>Ãšltimos Gastos</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let g of ultimos">
          <ion-label>
            <strong>{{ g.descricao }}</strong>
            <p class="muted">{{ g.categoria }} â€” {{ g.criadoEm | date:'dd/MM/yyyy' }}</p>
            <div>{{ formatCurrency(g.valor) }}</div>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

</ion-content>
