<ion-header [translucent]="true">
  <ion-toolbar color="tertiary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Gastos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Card superior: gráfico + total -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Resumo do Mês</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="resumo-top" style="display:flex;gap:16px;align-items:center;">
        <div style="flex:1;">
          <div>Total: <strong>{{ totalMesAtual | number:'1.2-2' | currency:'BRL':'symbol':'1.2-2' }}</strong></div>
          <div class="muted">Categorias do mês</div>
          <div class="titulo-pequeno">Gastos de {{ mesAtual | titlecase }}</div>
        </div>
        <div style="width:160px;height:120px;">
          <canvas #gastosChart style="width:100%;height:100%"></canvas>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Botões de adicionar -->
  <ion-grid>
    <ion-row>
      <ion-col size="8">
        <ion-item>
          <ion-input type="number" placeholder="Valor rápido (ex: 25.50)" [(ngModel)]="quickValor" inputmode="decimal"></ion-input>
        </ion-item>
      </ion-col>
      <ion-col size="4">
        <ion-button expand="block" color="primary" (click)="adicionarRapido()">Adicionar Rápido</ion-button>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col>
        <ion-button expand="block" fill="outline" (click)="abrirAlertDetalhado()">Adicionar Gasto Detalhado</ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Lista de últimos gastos -->
  <ion-list *ngIf="ultimos.length > 0; else semGastos">
    <ion-item *ngFor="let g of ultimos" [style.border-left]="'6px solid ' + getCategoriaColor(g.categoria)">
      <ion-label>
        <div><strong>{{ g.descricao }}</strong></div>
        <div class="muted">{{ g.categoria }} — {{ g.criadoEm | date:'dd/MM/yyyy' }}</div>
        <div>{{ formatCurrency(g.valor) }}</div>
      </ion-label>
      <ion-button fill="clear" slot="end" color="danger" (click)="remover(g)">Remover</ion-button>
    </ion-item>
  </ion-list>

  <ng-template #semGastos>
    <p class="ion-text-center muted">Nenhum gasto adicionado ainda.</p>
  </ng-template>
</ion-content>
