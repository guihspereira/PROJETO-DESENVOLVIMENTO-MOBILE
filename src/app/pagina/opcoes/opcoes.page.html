<ion-header [translucent]="true">
  <ion-toolbar color="tertiary">
    <ion-buttons slot="start"><ion-menu-button></ion-menu-button></ion-buttons>
    <ion-title>Opções</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding page-opcoes">

  <!-- Resumo -->
  <ion-card class="summary-card">
    <ion-card-header>
      <ion-card-title>Resumo</ion-card-title>
      <ion-card-subtitle>Gastos de {{ mesAtual | titlecase }}</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content class="summary-row">
      <div>
        <div class="label">Total (mês)</div>
        <div class="big">{{ totalMesAtual | currency:'BRL' }}</div>
      </div>
      <div class="meta-box">
        <div class="label">Meta Mensal</div>
        <div class="meta-value">{{ metamensal | currency:'BRL' }}</div>
        <div class="meta-edit">
          <ion-input type="number" placeholder="Nova meta mensal (R$)" [(ngModel)]="metamensal"></ion-input>
          <ion-button expand="block" (click)="salvarMeta()">Salvar Meta</ion-button>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Meta de Poupança -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Meta de Poupança</ion-card-title>
      <ion-card-subtitle>Quanto deseja guardar este mês?</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content class="meta-edit">
      <ion-input type="number" placeholder="Meta de poupança (R$)" [(ngModel)]="metaPoupanca"></ion-input>
      <ion-button expand="block" (click)="salvarMetaPoupanca()">Salvar Meta</ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Sugestões -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Sugestões Inteligentes</ion-card-title>
      <ion-card-subtitle>Toque para aplicar / desfazer</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-button expand="block" color="primary" (click)="gerarSugestoesInterativas()">Gerar Sugestões</ion-button>

      <ion-list>
        <ion-item>
          <ion-label>
            <h3>Áreas com potencial de economia</h3>
            <p>Baseado nos seus gastos recentes</p>
          </ion-label>
        </ion-item>
        <ion-item *ngFor="let area of areasEconomia">
          <ion-label>{{ area.nome }}</ion-label>
          <ion-badge color="warning">R$ {{ area.valor | number:'1.2-2' }}</ion-badge>
        </ion-item>
      </ion-list>

      <ion-list *ngIf="sugestoes.length > 0">
        <ion-item *ngFor="let s of sugestoes" (click)="aplicarSugestao(s)" [class.aplicada]="s.aplicado">
          <ion-label>
            <h3>{{ s.texto }}</h3>
            <p *ngIf="s.impacto">Impacto estimado: {{ s.impacto | currency:'BRL' }}</p>
          </ion-label>
          <ion-checkbox slot="end" [checked]="s.aplicado"></ion-checkbox>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Família -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Finanças da Família</ion-card-title>
      <ion-card-subtitle>Registre gastos por membro</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <div class="add-row">
        <ion-input placeholder="Nome" [(ngModel)]="novoNome"></ion-input>
        <ion-select [(ngModel)]="novoTipo" interface="popover" placeholder="Tipo">
          <ion-select-option value="Cônjuge">Cônjuge</ion-select-option>
          <ion-select-option value="Filho">Filho</ion-select-option>
          <ion-select-option value="Pai">Pai</ion-select-option>
          <ion-select-option value="Mãe">Mãe</ion-select-option>
          <ion-select-option value="Outro">Outro</ion-select-option>
        </ion-select>
        <ion-input type="number" placeholder="Gasto (R$)" [(ngModel)]="novoGasto"></ion-input>
        <ion-button (click)="adicionarParente()">Adicionar</ion-button>
      </div>

      <div class="familia-summary">
        <div>Total família: <strong>{{ totalFamilia() | currency:'BRL' }}</strong></div>
        <div>
          <ion-button fill="clear" size="small" (click)="guardarFinancas()">Guardar Finanças</ion-button>
          <ion-button fill="outline" size="small" (click)="verSnapshots()">Ver Snapshots</ion-button>
        </div>
      </div>

      <ion-list *ngIf="familia.length > 0">
        <ion-item *ngFor="let f of familia">
          <ion-avatar slot="start">
            <ion-icon [name]="getIconForTipo(f.tipo)"></ion-icon>
          </ion-avatar>
          <ion-label>
            <h3>{{ f.nome }}</h3>
            <p>{{ f.tipo }} — {{ f.gasto | currency:'BRL' }}</p>
          </ion-label>
          <ion-button color="danger" fill="clear" (click)="removerParente(f.id)">Remover</ion-button>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Gastos por Parente -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Gastos por Parente</ion-card-title>
      <ion-card-subtitle>Detalhes dos gastos registrados</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-list *ngIf="familia.length > 0; else noFam">
        <ion-item *ngFor="let f of familia">
          <ion-label>
            <h3>{{ f.nome }} ({{ f.tipo }})</h3>
            <p>Gasto registrado: R$ {{ f.gasto | number:'1.2-2' }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
      <ng-template #noFam>
        <p class="ion-text-center muted">Nenhum gasto familiar registrado.</p>
      </ng-template>
    </ion-card-content>
  </ion-card>

</ion-content>
